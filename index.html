<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Audio Visualizer based on Three.js</title>
  <link href="https://fonts.googleapis.com/css?family=Saira" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div id="header">
    <h1>MULTIMOD | MrGato y sus putas 2</h1>
  </div>
  <div id="right">
    <h2>DISCORD OFICIAL:</h2>
    <h3><a href="https://discord.gg/49BxqscV" target="_blank">https://discord.gg/49BxqscV</a></h3>
  </div>
  <div id="content">
    <audio id="audio" controls style="display: none;"></audio>
    <div id="out"></div>
  </div>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js'></script>
  <script src='https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/controls/OrbitControls.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.3/dat.gui.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.3.0/simplex-noise.min.js'></script>
  <script src="./script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const audio = document.getElementById('audio');
        let context;
        let src;
        let analyser;

        function getRandomSong() {
            const songs = [
                'audio/donki.mp3',
                'audio/kaskade.mp3',
                'audio/twofriends.mp3'
            ];
            const randomIndex = Math.floor(Math.random() * songs.length);
            return songs[randomIndex];
        }

        function playAudio(src) {
            audio.src = src;
            audio.load();
            audio.play().then(() => {
                if (!context) {
                    context = new (window.AudioContext || window.webkitAudioContext)();
                    src = context.createMediaElementSource(audio);
                    analyser = context.createAnalyser();
                    src.connect(analyser);
                    analyser.connect(context.destination);
                    analyser.fftSize = 512;
                    play();
                }
            }).catch(error => {
                console.error('Error playing audio:', error);
            });
        }

        function initAudio() {
            const randomSong = getRandomSong();
            if (randomSong) {
                playAudio(randomSong);
            }
        }

        function attemptAudioContextResume() {
            if (context && context.state === 'suspended') {
                context.resume().then(() => {
                    console.log('AudioContext resumed');
                }).catch(error => {
                    console.error('Error resuming AudioContext:', error);
                });
            }
        }

        function animate() {
            attemptAudioContextResume();
            requestAnimationFrame(animate);
        }

        // Inicia la animaci√≥n y el intento de reanudar el contexto de audio
        initAudio();
        animate();
    });
  </script>
</body>
</html>

